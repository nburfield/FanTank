/*!
 * BC Innovations, LLC - v1.0.0
 * Copyright 2017-2017 BC Innovations, LLC
 * Licensed under ISC
 */
function loadUser(){$.get(serverContext+"/user/data",function(e){e?($(".user").show(),$(".userName").html(e.firstName),userLogged=e,setInvestNowData(e),autoFillData(e),document.body.dispatchEvent(bindButtonsEvent)):$(".nouser").show()}).fail(function(e){$(".nouser").show()})}function loadOfferingData(e){$.get(serverContext+"/offerings/"+e,function(e){console.log(e);var t=moment(),n=moment(e.escrow_closes_at);daysLeft=n.diff(t,"days"),hoursLeft=n.diff(t,"hours"),minutesLeft=n.diff(t,"minutes");var o=parseFloat(e.funds_received);asking=parseFloat(e.amount),progress=Math.ceil(o/asking*100)}).done(function(e){minutesLeft<2&&(minutesLeft=3e3,$.notify("Escrow closed on Offering",{position:"right bottom",className:"error"})),$(".offeringDaysLeft").html(hoursLeft),$(".offeringDayHour").html("Days"),$(".offeringDaysLeft").prop("number",90).animateNumber({number:daysLeft,numberStep:function(e,t){var n=$(t.elem),o=Math.round(e);o<4&&$(".days-left").css("color","red"),n.text(o)}},1500,function(){minutesLeft<2880&&($(".offeringDayHour").html("Hours"),$(".offeringDaysLeft").prop("number",48).animateNumber({number:hoursLeft,numberStep:function(e,t){var n=$(t.elem),o=Math.round(e);n.text(o)}},500,function(){minutesLeft<120&&($(".offeringDayHour").html("Minutes"),$(".offeringDaysLeft").prop("number",120).animateNumber({number:minutesLeft,numberStep:function(e,t){var n=$(t.elem),o=Math.round(e);n.text(o)}},500))}))}),$(".progress-bar").css("width",progress+"%").attr("aria-valuenow",progress),$(".offeringPercent").animateNumber({number:progress},2e3);var t=$.animateNumber.numberStepFactories.separator(",");$(".offeringAsking").animateNumber({number:asking,numberStep:t},2e3)}).fail(function(e){$(".offeringDaysLeft").html(0),$(".offeringAsking").html(0),$(".offeringPercent").html(0),$(".progress-bar").css("width","0%").attr("aria-valuenow",0)})}function sendUserInvestment(e){$.post(serverContext+"/user/investment",e,function(e){$.notify("Investment Connection Success",{position:"right bottom",className:"success"})}).fail(function(e){$.notify(e.responseJSON.message,{position:"right bottom",className:"error"})})}function setInvestNowData(e){updateEvent.initEvent("fa.investnow.update",!0,!1),updateEvent.detail={email:e.email,id:e.id};try{document.body.dispatchEvent(clearEvent),document.body.dispatchEvent(updateEvent)}catch(e){console.error("Updated Event Error")}}function autoFillData(e){autofillEvent.initEvent("fa.investnow.autofill",!0,!1),autofillEvent.investor={name:e.firstName+" "+e.lastName,email:e.email,contact_name:e.firstName+" "+e.lastName},autofillEvent.associated_person={name:e.firstName+" "+e.lastName,email:e.email}}var serverContext=window.location.protocol+"//"+window.location.host+"/",userLogged=null,daysLeft=0,hoursLeft=0,minutesLeft=0,asking=0,progress=0;console.log("Calling my");var updateEvent=document.createEvent("Event"),autofillEvent=document.createEvent("Event"),clearEvent=document.createEvent("Event");clearEvent.initEvent("fa.investnow.clear",!0,!1);var bindButtonsEvent=document.createEvent("Event");bindButtonsEvent.initEvent("fa.investnow.bindButtons",!0,!1);var getDataEvent=document.createEvent("Event");getDataEvent.initEvent("fa.investnow.getData",!0,!1),document.addEventListener("fa.investnow.open",function(e){console.log("InvestNow Open"),document.body.dispatchEvent(autofillEvent),document.body.dispatchEvent(getDataEvent)}),$(document).ready(function(){$(".user").hide(),$(".nouser").hide(),loadUser(),loadOfferingData(window.location.pathname.split("/")[2])});